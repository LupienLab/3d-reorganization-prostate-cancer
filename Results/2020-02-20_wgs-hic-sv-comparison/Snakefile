import pandas as pd
import os.path as path

# ==============================================================================
# Configuration
# ==============================================================================
CONFIG = pd.read_csv(
    path.join("..", "..", "Data", "External", "LowC_Samples_Data_Available.tsv"),
    index_col=False, sep="\t"
)
CONFIG = CONFIG.loc[CONFIG.Include == "Yes"]
CONFIG["SampleID"] = ["PCa" + str(i) for i in CONFIG["Sample ID"]]
SAMPLES = CONFIG["SampleID"].tolist()

PLOT_EXTS=["png", "pdf"]

# ==============================================================================
# Meta Rules
# ==============================================================================
rule all:
    input:
        expand("detections.{type}.tsv", type=["all", "per-sample", "hic", "wgs"]),
        expand("detections.all.{ext}", ext=PLOT_EXTS),

# ==============================================================================
# Rules
# ==============================================================================
rule process:
    input:
        script = "compare-sv.py",
        wgs = expand(
            path.join("..", "..", "Data", "External", "CPC-GENE", "structural-variant-vcfs", "{sample}.hg38.sorted.bed"),
            sample=SAMPLES
        ),
        hic = path.join("..", "2020-02-19_chromoplexy", "Graphs", "sv-breakpoints.tsv"),
    output:
        expand("detections.{type}.tsv", type=["all", "per-sample", "hic", "wgs"]),
    shell:
        "python {input.script}"

rule plot:
    input:
        script = "plot-comparison.R",
        data = expand("detections.{type}.tsv", type=["all", "per-sample", "hic", "wgs"]),
    output:
        expand("detections.all.{ext}", ext=PLOT_EXTS),
    shell:
        "Rscript {input.script}"