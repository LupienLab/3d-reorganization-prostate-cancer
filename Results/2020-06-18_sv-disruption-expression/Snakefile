# ==============================================================================
# Configuration
# ==============================================================================
import pandas as pd
import os.path as path

CONFIG = pd.read_csv(
    path.join("..", "2020-02-19_chromoplexy", "Graphs", "sv-disruption-tests.tsv"),
    sep="\t",
    index_col=False,
)

TEST_IDS = CONFIG.test_ID.tolist()

PLOT_DIR = "Plots"

# ==============================================================================
# Meta Rules
# ==============================================================================
rule all:
    input:
        "results.genes.tsv",
        "results.transcripts.tsv",
        "t2e-comparison.genes.tsv",
        "t2e-comparison.transcripts.tsv",
        "sleuth-object.rds",
        expand(
            path.join("sleuth", "test_{test_ID}.{ext}"),
            test_ID=TEST_IDS,
            ext=[
                "genes.all.tsv",
                "transcripts.all.tsv",
                "genes.tested.tsv",
                "transcripts.tested.tsv",
                "sleuth-object.rds"
            ],
        ),

# ==============================================================================
# Rules
# ==============================================================================
rule t2e_comp:
    input:
        script = "t2e-dge.R",
    output:
        "results.genes.tsv",
        "results.transcripts.tsv",
        "t2e-comparison.genes.tsv",
        "t2e-comparison.transcripts.tsv",
        "sleuth-object.rds",
    shell:
        "Rscript {input.script}"

rule plot_erg:
    input:
        script = "plot-t2e.R",
        sleuth = "sleuth-object.rds",
        data = "t2e-comparison.transcripts.tsv"
    output:
        "outfile"
    shell:
        "python {input.script} {input.data} -o {output}"

rule sv_test_comp:
    input:
        script = "1sample-dge.sleuth.R",
    output:
        path.join("sleuth", "test_{test_ID}.genes.all.tsv"),
        path.join("sleuth", "test_{test_ID}.transcripts.all.tsv"),
        path.join("sleuth", "test_{test_ID}.genes.tested.tsv"),
        path.join("sleuth", "test_{test_ID}.transcripts.tested.tsv"),
        path.join("sleuth", "test_{test_ID}.sleuth-object.rds"),
    shell:
        "Rscript {input.script} {wildcards.test_ID}"
